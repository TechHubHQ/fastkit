"""Database base configuration."""

{% if db_choice in ["postgresql", "mysql", "sqlite", "mssql"] -%}
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
from app.core.config import settings

# SQLAlchemy setup
engine = create_engine(
    settings.DATABASE_URL,
    {% if db_choice == "sqlite" -%}
    connect_args={"check_same_thread": False}
    {% else -%}
    pool_pre_ping=True,
    pool_recycle=300
    {% endif -%}
)

SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base()


def get_db():
    """Get database session for dependency injection."""
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

{% elif db_choice == "mongodb" -%}
# MongoDB doesn't use SQLAlchemy; SQL constructs are not applicable.
Base = None
SessionLocal = None
engine = None

def get_db():
    """Not supported for MongoDB. Use get_mongo_db from app.db.session."""
    raise NotImplementedError("Use get_mongo_db from app.db.session for MongoDB")
{% endif -%}